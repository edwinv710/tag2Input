var TaggableInput=function(){var a="taggable-input",b="label",c=[" "],d={},e={beforeInsert:function(a,b){return a},afterInsert:function(a,b,c){}},f=function(a,b,c,d){var e=d.value.split(c);0===e[e.length-1].length&&e.pop(),a.add(e),d.value=""},g=function(a,b){var c=a.delimiter.join("|"),d=new RegExp(c);return function(c){d.test(this.value)&&f(a,b,d,this),b.innerText=this.value,this.style.width=b.clientWidth+(this.offsetWidth-this.clientWidth+5)+"px"}},h=function(b,c){if("string"==typeof b&&(b=document.getElementById(b)),!(b instanceof HTMLElement))throw"Please provide a valid container.";return"INPUT"===b.nodeName&&(b=document.createElement("div"),c.parentNode.insertBefore(b,c)),b.className=" "+a,b.onclick=function(a){a.target===this&&c.focus()},b},i=function(){var a=document.createElement("span"),b={position:"absolute",display:"inline-block",height:"0px",left:"0",top:"0",overflow:"hidden"};a.className="hiddenSpan";for(var c in b)a.style[c]=b[c];return a},j=function(a,b,c){var e=document.createElement("input"),f=c.getAttribute("data-cid");return console.log(b),e.setAttribute("type","hidden"),e.name=a+"["+b+"]",e.value=c.innerText,d[f]=e,e},k=function(a,b,c){var d;return d="INPUT"===b.nodeName?b:document.createElement("input"),d.setAttribute("type","text"),d.setAttribute("size","1"),d.addEventListener("input",g(a,c),!0),d.addEventListener("paste",g(a,c),!0),d.addEventListener("keyup",function(b){8==b.which&&0==this.value.length&&a.pop()}),d},l=function(a,b,c){a.appendChild(c),a.appendChild(b),b.removeAttribute("name")},m=function(a,b){return function(c){var d=document.getElementById(c.dataTransfer.getData("item")),e=c.target.parentNode,f=a?e:e.nextSibling;return e.parentNode.insertBefore(d,f),b._reset(),c.stopPropagation(),!1}},n=function(a,b){var c=Math.random().toString(36).substr(2,18).toUpperCase(),d=document.createElement("div"),e=document.createElement("span"),f=document.createElement("span"),g=document.createElement("span");return d.setAttribute("data-cid",c),d.className="label close",d.id="label-"+c,f.innerText=b,f.className="content",a.editable&&(f.setAttribute("contenteditable",!0),f.addEventListener("keydown",function(a){8===a.which&&1===this.innerHTML.length&&this.parentNode.parentNode.removeChild(this.parentNode)}),["keyup","mouseup","cut"].map(function(a){f.addEventListener(a,function(a){0==this.innerHTML.length&&this.parentNode.parentNode.removeChild(this.parentNode)})})),a.removable&&(d.className+=" close",g.addEventListener("click",function(b){a.remove(this.parentNode)})),e.className="drop-left",e.innerHTML="&nbsp;",g.innerHTML="&nbsp;",g.className="drop-right",d.appendChild(e),d.appendChild(f),d.appendChild(g),a.draggable&&(d.setAttribute("draggable","true"),e.addEventListener("dragenter",function(a){return a.preventDefault(),!0}),g.addEventListener("dragenter",function(a){return a.preventDefault(),!0}),e.addEventListener("dragover",function(a){return a.preventDefault(),!0}),g.addEventListener("dragover",function(a){return a.preventDefault(),!0}),e.addEventListener("drop",m(!0,a)),g.addEventListener("drop",m(!1,a)),d.addEventListener("dragstart",function(a){return a.dataTransfer.setData("item",this.id),!0})),d},o=function(a,b){var b=b||{},d=i();this.delimiter=b.delimiter||c,this.delimiter=this.delimiter instanceof Array?this.delimiter:[this.delimiter],this.delimiter=this.delimiter.map(function(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}),this.editable=0!=b.editable,this.draggable=0!=b.draggable,this.removable=0!=b.removable,this.input=k(this,a,d),this.container=h(a,this.input),this.input.name&&(this.name=this.input.name);for(var f in e)this[f]=b[f]||e[f];l(this.container,this.input,d)};return o.prototype={add:function(a){var b=this.tags().length;a=a instanceof Array?a:[a];for(var c=0;c<a.length;c++)if(a[c]=this.beforeInsert(a[c]),a[c]=n(this,a[c]),this.container.insertBefore(a[c],this.input),this.afterInsert(a[c]),this.name){var d=j(this.name,b,a[c]);this.container.appendChild(d)}},remove:function(a){return"number"==typeof a&&(a=this.tags(a)),a.parentNode.removeChild(a),this._reset(),a},pop:function(){var a=this.remove(-1);return a},tags:function(a){var c=this.container.getElementsByClassName(b);return a?(a=(c.length+a)%c.length,c[a]):c},values:function(){var a=this.container.getElementsByClassName("label");return[].map.call(a,function(a){return a.innerText})},_reset:function(){if(this.name){var a=this.tags();console.log(a);for(var b={},c=0;c<a.length;c++){var e=a[c].getAttribute("data-cid");console.log(e),b[e]=d[e],b[e].name=this.name+"["+c+"]",console.log(d[e]),d[e].parentNode.appendChild(d[e]),delete d[e]}console.log("left"),console.log(d);for(var f in d)if(d.hasOwnProperty(f)){var g=d[f];g.parentElement.removeChild(g)}d=b}}},o}();