var TaggableInput=function(){var a={tagClass:"simple",tagContainerClass:"ti-tag",containerClass:"taggable-input",close:"<span>x</span>",delimiters:{keycode:[32],separator:void 0},booleans:{true:["t","true","1",1,!0],false:["f","false","0",0,!1]},events:{beforeInsert:function(a){return a},afterInsert:function(a,b,c){}}},b={},c=function(a){if(a instanceof HTMLElement)return a;var b=document.createElement("div");return b.innerHTML=a,b.childNodes[0]},d=function(b){var c=Math.random().toString(36).substr(2,18).toUpperCase(),d=document.createElement("div");return d.className=a.tagContainerClass,d.innerHTML="<div class='ti-tag-drop'></div><div class='ti-tag-drop'></div><div class='ti-tag-body'><span class='ti-tag-content'>"+b+"</span></div>",d.setAttribute("data-cid",c),d},e=function(a){var b,c;a.container.addEventListener("dragstart",function(a){b=a.target,c=b.nextSibling,b.className+=" active"},!1),a.container.addEventListener("dragend",function(d){b.className=b.className.replace(/(^|\s)active/,""),b=void 0,c=void 0,a._reset()},!1),a.container.addEventListener("dragenter",function(d){b&&(a.container.contains(d.target)?d.target.className.includes("ti-tag-drop")&&!d.target.previousElementSibling?d.target.parentNode.parentNode.insertBefore(b,d.target.parentNode):d.target.className.includes("ti-tag-drop")&&d.target.parentNode.parentNode.insertBefore(b,d.target.parentNode.nextSibling):b.parentNode.insertBefore(b,c))},!1),a.container.addEventListener("dragleave",function(d){b&&a.container===d.target&&b.parentNode.insertBefore(b,c)},!1),a.container.addEventListener("drop",function(a){a.preventDefault()},!1)},f=function(){for(var b=document.querySelectorAll("."+a.containerClass+':not([data-complete="true"])'),c=0;c<b.length;c++){var d=[].reduce.apply(b[c].attributes,[function(a,b){return b.name.includes("data-")&&(a[b.name.replace("data-","").replace(/(\-\w)/,function(a){return a[1].toUpperCase()})]=b.value),a},{}]);console.log("attributes"),console.log(d);new q(b[c],d)}},g=function(a){return"string"==typeof a&&(a=a.split(",")),a},h=function(b){b=[].concat.apply([],[b]);for(var c={keycode:[],separator:[]},d=0;d<b.length;d++)isNaN(b[d])?"string"==typeof b[d]&&c.separator.push(b[d]):c.keycode.push(parseInt(b[d]));return 0===c.keycode.length&&0===c.separator.length?a.delimiters:(c.separator=c.separator.length?new RegExp(c.separator.join("|")):a.delimiters.separator,c)},i=function(b,c){if("string"==typeof b&&(b=document.getElementById(b)),!(b instanceof HTMLElement))throw"Please provide a valid container.";return"INPUT"===b.nodeName&&(b=document.createElement("div"),c.parentNode.insertBefore(b,c)),b.className=b.className.replace(a.containerClass,"")+" "+a.containerClass,b.id=b.id||Math.random().toString(36).substring(2,18).toUpperCase(),b.dataset.complete=!0,b.onclick=function(a){a.target===this&&c.focus()},b},j=function(){var a=document.createElement("span"),b={position:"absolute",display:"inline-block",height:"0px",left:"0",top:"0",overflow:"hidden"};a.className="hiddenSpan";for(var c in b)a.style[c]=b[c];return a},k=function(a,c,d){var e=document.createElement("input"),f=d.getAttribute("data-cid"),g=d.getElementsByClassName("ti-tag-content")[0].textContent;return e.setAttribute("type","hidden"),e.name=a+"["+c+"]",e.value=g,b[f]=e,e},l=function(a){return function(b){var c=a.delimiter.separator;c&&c.test(this.value)&&a._addTags(),a._calibrateInput()}},m=function(a,b,c){var d;return d="INPUT"===b.nodeName?b:document.createElement("input"),d.className=d.className.replace(/(^| +)+taggable-input($| +)+/," "),d.setAttribute("type","text"),d.setAttribute("size","1"),d.addEventListener("input",l(a),!0),d.addEventListener("paste",l(a),!0),d.addEventListener("keydown",function(b){8===b.which&&0===this.value.length?a.pop():a.delimiter.keycode.indexOf(b.which)!=-1&&(a._addTags(),a._calibrateInput())}),d},n=function(a,b,c){a.appendChild(c),a.appendChild(b),b.removeAttribute("name")},o=function(a){a.parentNode.parentNode.className+=" ti-editable",a.setAttribute("contenteditable",!0),a.addEventListener("keydown",function(a){13===a.which?a.preventDefault():8===a.which&&1===this.textContent.length&&this.parentNode.parentNode.parentNode.removeChild(this.parentNode)}),a.addEventListener("blur",function(a){var c=this.parentNode.parentNode.getAttribute("data-cid"),d=b[c];d&&(d.value=this.textContent)}),["keyup","mouseup","cut"].forEach(function(b){a.addEventListener(b,function(a){0==this.innerHTML.length&&this.parentNode.parentNode.removeChild(this.parentNode)})})},p=function(a,b){var c=document.createElement("div");c.className="ti-tag-close",c.appendChild(a.closeElement.cloneNode(!0)),c.addEventListener("click",function(c){a.remove(b.parentNode)}),b.appendChild(c)},q=function(b,d){var d=d||{};d.tag=d.tag||{};var f=g(d.values);this.tagClass=d.tag.klass||d.tagKlass||a.tagClass,this.closeElement=c(d.tag.close||d.tagClose||a.close),this.hiddenSpan=j(),this.delimiter=h(d.delimiter),this.editable=a.booleans.true.includes(d.editable),this.draggable=!a.booleans.false.includes(d.draggable),this.close=!a.booleans.false.includes(d.close),this.backspace=!a.booleans.false.includes(d.backspace),this.input=m(this,b,this.hiddenSpan),this.container=i(b,this.input),this.id=this.container.id,this.draggable&&e(this),this.input.name&&(this.name=this.input.name);for(var k in a.events)this[k]=d[k]||a.events[k];n(this.container,this.input,this.hiddenSpan),q.elements[this.id]=this,this.add(f)};return q.prototype={add:function(a){a=[].concat.apply([],Array.apply(null,arguments));var b=this;return a.reduce(function(a,c){var d=b._createTag(c);return d&&a.push(d),a},[])},remove:function(a){for(var b=[].concat(this.tags(a)),c=0;c<b.length;c++)b[c]&&b[c].parentNode.removeChild(b[c]);return this._reset(),b},pop:function(){var a=this.remove(-1);return a},tags:function(b){var c;return b instanceof HTMLElement?c=[].concat(b):(c=this.container.getElementsByClassName(a.tagContainerClass),"number"==typeof b?c=[c[(c.length+b)%c.length]]:"string"==typeof b&&(b=new Regexp("^"+b+"$")),b instanceof RegExp&&(c=[].reduce.apply(c,[function(a,c){return b.test(c.getElementsByClassName("ti-tag-content")[0].textContent)?a.concat(c):a},[]]))),Array.apply(null,c)},values:function(a){var b=this.tags(a);return[].map.call(b,function(a){return a.getElementsByClassName("ti-tag-content")[0].textContent})},_reset:function(){if(this.name){for(var a=this.tags(),c={},d=0;d<a.length;d++){var e=a[d].getAttribute("data-cid");c[e]=b[e],c[e].name=this.name+"["+d+"]",b[e].parentNode.appendChild(b[e]),delete b[e]}for(var f in b)if(b.hasOwnProperty(f)){var g=b[f];g.parentElement.removeChild(g)}b=c}},_addTags:function(){var a=this.input.value.split(this.delimiter.separator);0===a[a.length-1].length&&a.pop(),this.add(a),this.input.value=""},_createTag:function(a){if(a&&a.length){var b=this.tags().length;if(a=this.beforeInsert(a,b)){var c=d(a),e=c.getElementsByClassName("ti-tag-content")[0];if(e.parentNode.className+=" "+this.tagClass,this.editable&&o(e),this.close&&p(this,e.parentNode),this.draggable&&c.setAttribute("draggable","true"),this.name){var f=k(this.name,b,c);this.container.appendChild(f)}this.container.insertBefore(c,this.input),this.afterInsert(c,a,b)}}},_calibrateInput:function(){this.hiddenSpan.textContent=this.input.value,this.input.style.width=this.hiddenSpan.clientWidth+(this.input.offsetWidth-this.input.clientWidth+5)+"px"}},q.elements={},window.onload=function(){f()},q}();